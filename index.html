<!DOCTYPE html>
<html lang="en">
<head>
Â  Â  <meta charset="UTF-8">
Â  Â  <title>TV Dashboard</title>
Â  Â  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>

Â  Â  <style>
Â  Â  Â  Â  body {
Â  Â  Â  Â  Â  Â  margin: 0;
Â  Â  Â  Â  Â  Â  font-family: Arial, sans-serif;
Â  Â  Â  Â  Â  Â  background: #0f172a;
Â  Â  Â  Â  Â  Â  color: white;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  }

Â  Â  Â  Â  .header {
Â  Â  Â  Â  Â  Â  background: #1e293b;
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  font-size: 42px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  font-weight: bold;
Â  Â  Â  Â  Â  Â  border-bottom: 4px solid #334155;
Â  Â  Â  Â  Â  Â  position: relative;
Â  Â  Â  Â  Â  Â  z-index: 10;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  Â  Â  align-items: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  #content {
Â  Â  Â  Â  Â  Â  padding: 10px;
Â  Â  Â  Â  Â  Â  height: 85vh;Â 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  transition: all 0.3s ease;
Â  Â  Â  Â  }

Â  Â  Â  Â  body.fullscreen-mode .header { display: none; }
Â  Â  Â  Â  body.fullscreen-mode #content { height: 100vh; padding: 0; }

Â  Â  Â  Â  #scroll-container {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  overflow-y: hidden;Â 
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  flex-direction: column;
Â  Â  Â  Â  }

Â  Â  Â  Â  table {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  border-collapse: collapse;
Â  Â  Â  Â  Â  Â  background: #1e293b;
Â  Â  Â  Â  Â  Â  table-layout: fixed;Â 
Â  Â  Â  Â  }

Â  Â  Â  Â  th {
Â  Â  Â  Â  Â  Â  background: #334155;
Â  Â  Â  Â  Â  Â  padding: 15px;
Â  Â  Â  Â  Â  Â  font-size: 45px;
Â  Â  Â  Â  Â  Â  border: 2px solid #475569;
Â  Â  Â  Â  Â  Â  position: sticky;
Â  Â  Â  Â  Â  Â  top: 0;
Â  Â  Â  Â  Â  Â  z-index: 5;
Â  Â  Â  Â  }

Â  Â  Â  Â  td {
Â  Â  Â  Â  Â  Â  padding: 20px;
Â  Â  Â  Â  Â  Â  text-align: center;
Â  Â  Â  Â  Â  Â  border: 2px solid #475569;
Â  Â  Â  Â  Â  Â  font-size: 55px;
Â  Â  Â  Â  Â  Â  word-wrap: break-word;
Â  Â  Â  Â  Â  Â  line-height: 1.3;
Â  Â  Â  Â  }

Â  Â  Â  Â  /* Status Colors */
Â  Â  Â  Â  .gate-0 { background: #059669; } /* Green */
Â  Â  Â  Â  .gate-1 { background: #10b981; } /* Light Green */
Â  Â  Â  Â  .gate-2 { background: #f59e0b; } /* Orange/Amber */
Â  Â  Â  Â  .gate-3 { background: #ea580c; } /* Deep Orange */
Â  Â  Â  Â  .gate-4 { background: #dc2626; } /* Red */
Â  Â  Â  Â  .status-default { background: #b45309; color: white; }

Â  Â  Â  Â  @keyframes kenburns {
Â  Â  Â  Â  Â  Â  0% { transform: scale(1); }
Â  Â  Â  Â  Â  Â  100% { transform: scale(1.5); }
Â  Â  Â  Â  }

Â  Â  Â  Â  .img-et-container {
Â  Â  Â  Â  Â  Â  height: 100vh;
Â  Â  Â  Â  Â  Â  width: 100vw;
Â  Â  Â  Â  Â  Â  background: black;
Â  Â  Â  Â  Â  Â  overflow: hidden;
Â  Â  Â  Â  Â  Â  display: flex;
Â  Â  Â  Â  Â  Â  justify-content: center;
Â  Â  Â  Â  }

Â  Â  Â  Â  .img-et-container img {
Â  Â  Â  Â  Â  Â  width: 100%;
Â  Â  Â  Â  Â  Â  height: 100%;
Â  Â  Â  Â  Â  Â  object-fit: contain;
Â  Â  Â  Â  Â  Â  animation: kenburns 30s linear forwards;
Â  Â  Â  Â  }
Â  Â  </style>
</head>
<body>

<div id="displaySection">
Â  Â  <div class="header" id="header-container">
Â  Â  Â  Â  <span id="title">Loading Dashboard...</span>
Â  Â  </div>
Â  Â  <div id="content">
Â  Â  Â  Â  <div id="scroll-container"></div>
Â  Â  </div>
</div>

<script>
/* --- CONFIGURATION --- */
const FILE_NAME = "assignments.xlsx";Â 
const OTHER_DISPLAY_TIME = 12000;Â 
const ET_IMAGE_TIME = 30000;Â 
const COLS_PER_PAGE = 5;Â 
const SCROLL_SPEED = 2.5;Â 
const EDGE_PAUSE_MS = 2000;Â 

const IMAGE_LIST = ["notice0.png", "notice1.png"];
const IMAGE_LIST_2 = ["img1.jpg", "img2.jpg", "img3.jpg"];

/* --- GLOBALS --- */
let workbook;
let displays = [];
let currentDisplay = 0;
let currentEtImageIndex = 0;Â 
let rotationTimeout;
let scrollInterval;
let isTransitioning = false;

window.onload = loadExcel;

async function loadExcel() {
Â  Â  try {
Â  Â  Â  Â  const response = await fetch(`${FILE_NAME}?t=${new Date().getTime()}`);
Â  Â  Â  Â  if (!response.ok) throw new Error("File not found");
Â  Â  Â  Â  const data = await response.arrayBuffer();
Â  Â  Â  Â  workbook = XLSX.read(new Uint8Array(data), { type: 'array' });
Â  Â  Â  Â  buildDisplayList();
Â  Â  Â  Â Â 
Â  Â  Â  Â  // After loading/re-loading, start from the beginning
Â  Â  Â  Â  currentDisplay = 0;Â 
Â  Â  Â  Â  startRotation();
Â  Â  } catch (err) {
Â  Â  Â  Â  document.getElementById("title").innerText = "File Error / Searching File...";
Â  Â  Â  Â  // If file fails, try again in 10 seconds
Â  Â  Â  Â  setTimeout(loadExcel, 10000);
Â  Â  }
}

function buildDisplayList() {
Â  Â  const newDisplays = [];
Â  Â  workbook.SheetNames.forEach(name => {
Â  Â  Â  Â  const sheet = workbook.Sheets[name];
Â  Â  Â  Â  const rows = XLSX.utils.sheet_to_json(sheet, { defval: "" });
Â  Â  Â  Â  const lowerName = name.toLowerCase().trim();

Â  Â  Â  Â  if (lowerName === "shop visit status") {
Â  Â  Â  Â  Â  Â  const headers = Object.keys(rows[0] || {});
Â  Â  Â  Â  Â  Â  const modelCol = detectColumn(headers, ["model", "type", "engine"]) || headers[0];
Â  Â  Â  Â  Â  Â  const uniqueModels = [...new Set(rows.map(r => r[modelCol]))].filter(m => m);
Â  Â  Â  Â  Â  Â  const totalPages = Math.ceil(uniqueModels.length / COLS_PER_PAGE);
Â  Â  Â  Â  Â  Â Â 
Â  Â  Â  Â  Â  Â  for (let i = 0; i < uniqueModels.length; i += COLS_PER_PAGE) {
Â  Â  Â  Â  Â  Â  Â  Â  newDisplays.push({Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  type: "sheet",Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  name: name,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isConventional: false,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  isScroller: true,Â 
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  models: uniqueModels.slice(i, i + COLS_PER_PAGE),
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentPage: Math.floor(i / COLS_PER_PAGE) + 1,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  totalPages: totalPages
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  } else {
Â  Â  Â  Â  Â  Â  newDisplays.push({ type: "sheet", name: name, isConventional: true, isScroller: false });
Â  Â  Â  Â  }
Â  Â  });
Â  Â  newDisplays.push({ type: "image" });Â  Â  Â Â 
Â  Â  newDisplays.push({ type: "imageEt" });Â 
Â  Â  newDisplays.push({ type: "notification" });
Â  Â  displays = newDisplays;
}

function getStatusClass(status) {
Â  Â  if (!status) return "status-default";
Â  Â  const s = String(status).toLowerCase();
Â  Â  if (s.includes("gate 0")) return "gate-0";
Â  Â  if (s.includes("gate 1") || s.includes("disassembly") || s.includes("cleaning") || s.includes("inspection")) return "gate-1";
Â  Â  if (s.includes("gate 2")) return "gate-2";
Â  Â  if (s.includes("gate 3")) return "gate-3";
Â  Â  if (s.includes("gate 4")) return "gate-4";
Â  Â  return "status-default";
}

function showSheet(displayObj) {
Â  Â  document.body.classList.remove("fullscreen-mode");
Â  Â  const sheet = workbook.Sheets[displayObj.name];
Â  Â  let allRows = XLSX.utils.sheet_to_json(sheet, { defval: "" });
Â  Â Â 
Â  Â  let pageSuffix = displayObj.totalPages > 1 ? ` (${displayObj.currentPage}/${displayObj.totalPages})` : "";
Â  Â  document.getElementById("title").innerText = displayObj.name + pageSuffix;

Â  Â  const headers = Object.keys(allRows[0] || {});
Â  Â  let html = "<table>";

Â  Â  if (displayObj.isConventional) {
Â  Â  Â  Â  html += "<tr>" + headers.map(h => `<th>${h}</th>`).join("") + "</tr>";
Â  Â  Â  Â  allRows.forEach(row => {
Â  Â  Â  Â  Â  Â  html += "<tr>" + headers.map(h => `<td>${row[h]}</td>`).join("") + "</tr>";
Â  Â  Â  Â  });
Â  Â  } else {
Â  Â  Â  Â  const modelCol = detectColumn(headers, ["model", "type", "engine"]) || headers[0];
Â  Â  Â  Â  const snCol = detectColumn(headers, ["sn", "serial", "esn"]) || headers[1];
Â  Â  Â  Â  const statusCol = detectColumn(headers, ["status", "state"]);
Â  Â  Â  Â  const engineerCol = detectColumn(headers, ["assigned", "person", "engineer"]);

Â  Â  Â  Â  const peopleMap = {};
Â  Â  Â  Â  displayObj.models.forEach(m => peopleMap[m] = []);

Â  Â  Â  Â  allRows.forEach(r => {
Â  Â  Â  Â  Â  Â  const model = r[modelCol];
Â  Â  Â  Â  Â  Â  if (displayObj.models.includes(model)) {
Â  Â  Â  Â  Â  Â  Â  Â  const status = statusCol ? String(r[statusCol]) : "";
Â  Â  Â  Â  Â  Â  Â  Â  if (status.toLowerCase() === "complete") return;
Â  Â  Â  Â  Â  Â  Â  Â  peopleMap[model].push({
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  text: `<b>${r[snCol] || ""}</b><br>${r[engineerCol] || ""}<br><small>${status}</small>`,
Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  status: status
Â  Â  Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  }
Â  Â  Â  Â  });

Â  Â  Â  Â  html += "<tr>" + displayObj.models.map(m => `<th>${m}</th>`).join("") + "</tr>";
Â  Â  Â  Â  const maxRows = Math.max(...displayObj.models.map(m => peopleMap[m].length), 0);
Â  Â  Â  Â  for (let i = 0; i < maxRows; i++) {
Â  Â  Â  Â  Â  Â  html += "<tr>";
Â  Â  Â  Â  Â  Â  displayObj.models.forEach(m => {
Â  Â  Â  Â  Â  Â  Â  Â  const item = peopleMap[m][i];
Â  Â  Â  Â  Â  Â  Â  Â  const cls = item ? getStatusClass(item.status) : "";
Â  Â  Â  Â  Â  Â  Â  Â  html += `<td class="${cls}">${item ? item.text : ""}</td>`;
Â  Â  Â  Â  Â  Â  });
Â  Â  Â  Â  Â  Â  html += "</tr>";
Â  Â  Â  Â  }
Â  Â  }
Â  Â  html += "</table>";
Â  Â  const container = document.getElementById("scroll-container");
Â  Â  container.innerHTML = html;
Â  Â Â 
Â  Â  if (displayObj.isScroller) initAutoScroll(container);
}

function initAutoScroll(container) {
Â  Â  if (scrollInterval) clearInterval(scrollInterval);
Â  Â  container.scrollTop = 0;
Â  Â  let direction = 1; let hasReachedBottom = false; let isPaused = true;Â 
Â  Â  setTimeout(() => { isPaused = false; }, EDGE_PAUSE_MS);

Â  Â  scrollInterval = setInterval(() => {
Â  Â  Â  Â  if (isPaused) return;
Â  Â  Â  Â  const maxScroll = container.scrollHeight - container.clientHeight;
Â  Â  Â  Â  if (maxScroll <= 15) {
Â  Â  Â  Â  Â  Â  clearInterval(scrollInterval);
Â  Â  Â  Â  Â  Â  setTimeout(nextSlide, EDGE_PAUSE_MS);
Â  Â  Â  Â  Â  Â  return;
Â  Â  Â  Â  }
Â  Â  Â  Â  container.scrollTop += (SCROLL_SPEED * direction);
Â  Â  Â  Â  if (direction === 1 && container.scrollTop >= maxScroll - 1) {
Â  Â  Â  Â  Â  Â  isPaused = true; direction = -1; hasReachedBottom = true;
Â  Â  Â  Â  Â  Â  setTimeout(() => { isPaused = false; }, EDGE_PAUSE_MS);
Â  Â  Â  Â  }
Â  Â  Â  Â  if (hasReachedBottom && direction === -1 && container.scrollTop <= 0) {
Â  Â  Â  Â  Â  Â  isPaused = true; clearInterval(scrollInterval);
Â  Â  Â  Â  Â  Â  setTimeout(nextSlide, EDGE_PAUSE_MS);
Â  Â  Â  Â  }
Â  Â  }, 30);
}

function showImageEt() {
Â  Â  document.body.classList.add("fullscreen-mode");
Â  Â  const imgPath = IMAGE_LIST_2[currentEtImageIndex];
Â  Â  document.getElementById("scroll-container").innerHTML = `<div class="img-et-container"><img src="${imgPath}"></div>`;

Â  Â  currentEtImageIndex = (currentEtImageIndex + 1) % IMAGE_LIST_2.length;
Â  Â  rotationTimeout = setTimeout(nextSlide, ET_IMAGE_TIME);
}

function showImage() {
Â  Â  document.body.classList.remove("fullscreen-mode");
Â  Â  document.getElementById("title").innerText = "Maintenance Service Letters";
Â  Â  document.getElementById("scroll-container").innerHTML = `
Â  Â  Â  Â  <div style="display:flex; height:100%; justify-content:center; align-items:center; gap:20px;">
Â  Â  Â  Â  Â  Â  <img src="${IMAGE_LIST[0]}" style="max-height:95%; border-radius:10px;">
Â  Â  Â  Â  Â  Â  <img src="${IMAGE_LIST[1]}" style="max-height:95%; border-radius:10px;">
Â  Â  Â  Â  </div>`;
Â  Â  rotationTimeout = setTimeout(nextSlide, OTHER_DISPLAY_TIME);
}

function showNotification() {
Â  Â  document.body.classList.remove("fullscreen-mode");
Â  Â  document.getElementById("title").innerText = "Notifications";
Â  Â  document.getElementById("scroll-container").innerHTML = `
Â  Â  Â  Â  <div style="height:100%; display:flex; justify-content:center; align-items:center; font-size:50px;">
Â  Â  Â  Â  Â  Â  <ul style="list-style:none;padding:0;text-align:center;">
Â  Â  Â  Â  Â  Â  Â  Â  <li><h1>ðŸ“¢ Update Status Regularly</h1></li>
Â  Â  Â  Â  Â  Â  Â  Â  <li><h1>ðŸ“¢ Crew meeting at 4 PM</h1></li>
Â  Â  Â  Â  Â  Â  </ul>
Â  Â  Â  Â  </div>`;
Â  Â  rotationTimeout = setTimeout(nextSlide, OTHER_DISPLAY_TIME);
}

function startRotation() {
Â  Â  isTransitioning = false;
Â  Â  const d = displays[currentDisplay];
Â  Â  if (!d) return;

Â  Â  if (d.type === "sheet") {
Â  Â  Â  Â  showSheet(d);
Â  Â  Â  Â  if (!d.isScroller) rotationTimeout = setTimeout(nextSlide, OTHER_DISPLAY_TIME);
Â  Â  } else if (d.type === "image") {
Â  Â  Â  Â  showImage();
Â  Â  } else if (d.type === "imageEt") {
Â  Â  Â  Â  showImageEt();
Â  Â  } else if (d.type === "notification") {
Â  Â  Â  Â  showNotification();
Â  Â  }
}

function nextSlide() {
Â  Â  if (isTransitioning) return;
Â  Â  isTransitioning = true;
Â  Â  if (rotationTimeout) clearTimeout(rotationTimeout);
Â  Â  if (scrollInterval) clearInterval(scrollInterval);

Â  Â  let nextIndex = currentDisplay + 1;
Â  Â Â 
Â  Â  // Check if we have finished all slides
Â  Â  if (nextIndex >= displays.length) {
Â  Â  Â  Â  // RESET: Load Excel fresh before starting the next loop
Â  Â  Â  Â  loadExcel();
Â  Â  } else {
Â  Â  Â  Â  currentDisplay = nextIndex;
Â  Â  Â  Â  startRotation();
Â  Â  }
}

function detectColumn(headers, options) {
Â  Â  for (let opt of options) {
Â  Â  Â  Â  const found = headers.find(h => h.toLowerCase().includes(opt));
Â  Â  Â  Â  if (found) return found;
Â  Â  }
Â  Â  return null;
}
</script>
</body>
</html>
